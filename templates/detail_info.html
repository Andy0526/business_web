{% extends "detail_header.html" %}

{% block body %}

    <!-- 显示导航栏 -->
    <div class="container" style="margin-top: 70px">
        <ol class="breadcrumb">
            <li class="active" id="platform_name">{{ platform_name }}</li>
        </ol>
    </div>

    <!-- 显示内容 -->
    <div class="container">

        <div class="row">
            <div class="col-md-12">
                <table class="table table-bordered">

                    <tbody style="text-align: center">
                    <tr style="text-align: left " class="info">
                        <td colspan="2"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp基本信息
                        </td>
                    </tr>

                    <tr>
                        <td>评级</td>
                        <td id="platform_rank"></td>
                    </tr>
                    <td>人气指数</td>
                    <td id="platform_index"></td>
                    </tr>
                    <tr>
                        <td>平均收益</td>
                        <td id="platform_earn"></td>
                    </tr>
                    <tr>
                        <td>平台背景</td>
                        <td id="platform_background"></td>
                    </tr>
                    <tr>
                        <td>上线时间</td>
                        <td id="platform_time"></td>
                    </tr>
                    <tr>
                        <td>平均利率</td>
                        <td id="platform_rate"></td>
                    </tr>
                    <tr>
                        <td> 成交量</td>
                        <td id="platform_volume"></td>
                    </tr>
                    <tr>
                        <td>平均借款期限</td>
                        <td id="platform_borrowing_period"></td>
                    </tr>
                    <tr>
                        <td>累计待还金额</td>
                        <td id="platform_need_return"></td>
                    </tr>

                    <tr class="info" style="text-align: left" id="platform_comment_title">
                        <td colspan="2"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp用户评论
                        </td>
                    </tr>

                    <tr id="platform_comment_block">
                        <td colspan="2">
                            <div id="comment_div" style="width:600px;height:400px;margin: 5px auto;"/>
                        </td>
                    </tr>


                    <tr class="info" style="text-align: left" id="news_title">
                        <td colspan="2"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp相关新闻
                        </td>
                    </tr>
                    <tr id="news_block">
                        <td colspan="2" style="padding: 0 0 0  0;">
                            <div id="news_div" style="width: 100%"></div>
                        </td>
                    </tr>

                    </tbody>
                </table>

            </div>

        </div>

    </div>
    <script src="{{ url_for("static",filename='js/echarts.min.js') }}"></script>
    <script>
        // 加载数据
        $(document).ready(function () {
            var platform_name = $("#platform_name").text();
            // 显示
            $.getJSON("/detail/platform/" + platform_name + "/info", function (data) {

                $('#platform_rank').text(data['platform_rank']);
                $('#platform_index').text(data['platform_index']);
                $('#platform_earn').text(data['platform_earn']);
                $('#platform_background').text(data['platform_background']);
                $('#platform_time').text(data['platform_time']);
                $('#platform_rate').text(data['platform_rate']);
                $('#platform_volume').text(data['platform_volume']);
                $('#platform_borrowing_period').text(data['platform_borrowing_period']);
                $('#platform_need_return').text(data['platform_need_return']);

                var comment_data = data['frequent_label']
                if (comment_data.length > 0) {
                    show_commnet(platform_name, comment_data)
                } else {
                    $('#platform_comment_title').hide();
                    $('#platform_comment_block').hide();
                }
            });


            $.getJSON("/detail/platform/" + platform_name + "/news", function (data) {
                var recent_news_list = data['recent_news_list'];
                var related_news_list = data['related_news_list'];
                var num = recent_news_list.length + related_news_list.length

                if (num == 0) {
                    $('#news_title').hide();
                    $('#news_block').hide();
                } else {
                    for (var i = 0; i < recent_news_list.length; ++i) {
                        $('#news_div').append(
                                "<a href='" + recent_news_list[i].url + "' target='_blank' class='list-group-item' style='border-left: none;border-right: none;border-bottom: none'>" +
                                "<div class='row'>" +
                                "<div class='col-md-12' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" + recent_news_list[i].title + "&nbsp;&nbsp;<strong style='color:red;font-style:italic;'> New </strong></div>" +
                                "</div>" +
                                "</a>"
                        );
                    }

                    for (var i = 0; i < related_news_list.length; ++i) {
                        $('#news_div').append(
                                "<a href='" + related_news_list[i].url + "' target='_blank' class='list-group-item' style='border-left: none;border-right: none;border-bottom: none'>" +
                                "<div class='row'>" +
                                "<div class='col-md-12' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" + related_news_list[i].title + "</div>" +
                                "</div>" +
                                "</a>"
                        );
                    }

                }

            });


        });

        function show_commnet(platform_name, comment_data) {
            var comment_chart = echarts.init(document.getElementById('comment_div'));
            var comment_option = {
                title: {
                    text: platform_name + '的用户评价',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{b} : {d}%"
                },
                toolbox: {
                    show: true,
                    feature: {

                        saveAsImage: {show: true}
                    }
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']
                },
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: '70%',
                        center: ['50%', '60%'],
                        data: comment_data,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            comment_chart.setOption(comment_option);
        }
    </script>


    </div>
    </div>


{% endblock %}            