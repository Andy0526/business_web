{% extends "layout.html" %}

{% block title %} 平台详情 {% endblock %}

{% block body %}

    <!-- 显示导航栏 -->
    <div class="container" style="margin-top: 70px">




        <div class="row">
            <div class="col-md-12">
                <table class="table table-bordered">

                    <tbody style="text-align: center">

                       <tr style="text-align: left " class="bg-info">
                        <td colspan="2">
                            <img  class="img-responsive" src="{{ url_for("static",filename='img/detail.png') }}" style="width:42px;height:42px;margin-bottom:0px;float: left" >
<span  id="platform_name"  style="float: left;font-size:32px;margin-left: 10px;">{{ platform_name }}</span>

                        </td>
                    </tr>
                       </tbody>
                    </table>

                <table class="table table-bordered">

                    <tbody style="text-align: center">

                       <tr style="text-align: left " >
                        <td id="platform_comment_title" class="info" colspan="2"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp基本信息
                        </td>
                    </tr>


                    <tr>
                        <td>综合排名</td>
                        <td id="platform_rank"></td>
                    </tr>

                    <tr>
                        <td>平均收益(%)</td>
                        <td id="platform_earn"></td>
                    </tr>

                    <tr>
                        <td>上线时间</td>
                        <td id="platform_time"></td>
                    </tr>

                    <tr>
                        <td> 注册资本(万)</td>
                        <td id="platform_volume"></td>
                    </tr>
                    <tr>
                        <td>投资期限</td>
                        <td id="platform_borrowing_period"></td>
                    </tr>
                    <tr>
                        <td>所在地区</td>
                        <td id="platform_need_return"></td>
                    </tr>

                    <tr style="text-align: left ">
                        <td id="platform_comment_title" class="info" colspan="2"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp用户评论
                        </td>
                    </tr>
                    <tr>
                        <td id="platform_comment_block" colspan="2">
                            <div id="comment_div" style="width:100%;height:400px;"/>
                        </td>
                    </tr>


                    <tr class="info" style="text-align: left">
                        <td id="chart_ll_title" width="50%"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp利率信息
                        </td>
                        <td id="chart_cjl_title" width="50%"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp成交量信息
                        </td>
                    </tr>
                    <tr>
                        <td id="chart_ll" width="50%">
                            <div id="chart_ll_div" style="width:100%;height:400px;margin: 5px auto;"/>
                        </td>

                        <td id="chart_cjl" width="50%">
                            <div id="chart_cjl_div" style="width:100%;height:400px;margin: 5px auto;"/>
                        </td>
                    </tr>


                    <tr class="info" style="text-align: left">
                        <td id="chart_chart_dhk_title" width="50%"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp待还款
                        </td>
                        <td id="chart_zjlr_title" width="50%"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp资金净流入
                        </td>
                    </tr>
                    <tr>
                        <td id="chart_dhk" width="50%">
                            <div id="chart_dhk_div" style="width:100%;height:400px;margin: 5px auto;"/>
                        </td>

                        <td id="chart_dhk" width="50%">
                            <div id="chart_zjlr_div" style="width:100%;height:400px;margin: 5px auto;"/>
                        </td>
                    </tr>

                    <tr class="info" style="text-align: left">
                        <td id="chart_tzrs_title" width="50%"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp投资人数
                        </td>
                        <td id="chart_jkrs_title" width="50%"> <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp借款人数
                        </td>
                    </tr>
                    <tr>
                        <td id="chart_tzrs" width="50%">
                            <div id="chart_tzrs_div" style="width:100%;height:400px;margin: 5px auto;"/>
                        </td>

                        <td id="chart_jkrs" width="50%">
                            <div id="chart_jkrs_div" style="width:100%;height:400px;margin: 5px auto;"/>
                        </td>
                    </tr>

                    <tr class="info" style="text-align: left" id="news_title">
                        <td colspan="2">
                            <span class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp相关新闻
                        </td>
                    </tr>
                    <tr style="text-align: center;">
                        <td colspan="2" style="padding: 0 0 0  0;" >
                            <div id="news_div" ></div>
                        </td>
                    </tr>


                        <tr class="info" style="text-align: left;">
                             <td  colspan="2" > <span
                                class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp用户评论
                             </td>
                       </tr>


                        <tr style="text-align: center;">
<td colspan="2" style="padding: 0 0 0  0;" >
                            <div id="comments_div" style='width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'></div>
                        </td>

                    </tr>

                    </tbody>
                </table>

            </div>

        </div>

    </div>

    <script>
        // 加载数据
        $(document).ready(function () {
            var platform_name = $("#platform_name").text();
            // 显示
            $.getJSON("/detail/platform/" + platform_name + "/info", function (data) {

                $('#platform_rank').text(data['rank']);
                $('#platform_earn').text(data['platEarnings']);
                $('#platform_volume').text(data['registeredCapital']);
   $('#platform_borrowing_period').text(data['term']);
   $('#platform_time').text(data['onlineDate']);
                $('#platform_need_return').text(data['locationAreaName']+data['locationCityName']);

                var frequent_label = data['frequent_label']
                if (frequent_label.length > 0) {
                    show_frequent_label(platform_name, frequent_label)
                } else {
                    // $('#platform_comment_title').hide();
                    $('#platform_comment_block').text("此平台无数据");
                }


                 var comments_data_list = data['comments_data_list']

                if (comments_data_list.length > 0) {
                    show_comments_data_list(comments_data_list)
                } else {
                    // $('#platform_comment_title').hide();
                    $('#comments_div').html("此平台无数据");
                }




                //alert(data['chart_json']['0']['x'])
                if (data['chart_json']['0'] == null) {
                    $("#chart_ll_div").text("此平台无数据");
                    $("#chart_cjl_div").text("此平台无数据");
                    $("#chart_dhk_div").text("此平台无数据");
                    $("#chart_zjlr_div").text("此平台无数据");
                    $("#chart_tzrs_div").text("此平台无数据");
                    $("#chart_jkrs_div").text("此平台无数据");

                } else {

                    show_chart('chart_ll_div', '利率信息', data['chart_json']['0']['x'], data['chart_json']['0']['y1'], '百分比(%)');
                    show_chart('chart_cjl_div', '成交量信息', data['chart_json']['0']['x'], data['chart_json']['0']['y2'], '成交量(万)');
                    show_chart('chart_dhk_div', '待还款信息', data['chart_json']['1']['x'], data['chart_json']['1']['y1'], '代还款(万)');
                    show_chart('chart_zjlr_div', '资金净流入', data['chart_json']['1']['x'], data['chart_json']['1']['y2'], '净流入资金(万)');
                    show_chart('chart_tzrs_div', '投资人数', data['chart_json']['2']['x'], data['chart_json']['2']['y1'], '投资人数(个)');
                    show_chart('chart_jkrs_div', '借款人数', data['chart_json']['2']['x'], data['chart_json']['2']['y2'], '借款人数(个)');
                }





            });


            function show_chart(div_id, data_text, data_x, data_y, y_name) {

                var chart = echarts.init(document.getElementById(div_id));
                var option = {
                    //title: {
                     //   text: data_text
                    //},
                    tooltip: {
                        trigger: 'axis'
                    },
                    //legend: {
                    //    data: [data_text]
                    //},
                    xAxis: [
                        {
                            type: 'category',
                            boundaryGap: false,
                            data: data_x
                        }
                    ],
                    yAxis: [
                        {
                            name: y_name,
                            type: 'value'
                        }
                    ],
                    series: [
                        {
                            name: data_text,
                            type: 'line',
                            stack: '总量',
                            label: {
                                normal: {
                                    show: true,
                                    position: 'top'
                                }
                            },
                            areaStyle: {normal: {}},
                            data: data_y
                        }
                    ]
                };

                chart.setOption(option);


            }


            function show_comments_data_list(comments_data_list){

                    for (var i = 0; i < comments_data_list.length; ++i) {
                        $('#comments_div').append(

                                 "<a class='list-group-item' style='border-left: none;border-right: none;border-bottom: none'>" +
                                "<div class='row' style='max-width:1147px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" +
                                "<div class='col-md-12' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" + comments_data_list[i].comment + "</div>" +
                                "</div>" +
                                "</a>"



                        );
                    }

            }

            $.getJSON("/detail/platform/" + platform_name + "/news", function (data) {
                var recent_news_list = data['recent_news_list'];
                var related_news_list = data['related_news_list'];
                var num = recent_news_list.length + related_news_list.length

                if (num == 0) {
                    //$('#news_title').hide();
                    $('#news_div').text("此平台无数据");
                } else {
                    for (var i = 0; i < recent_news_list.length; ++i) {
                        $('#news_div').append(
                                "<a href='" + recent_news_list[i].url + "' target='_blank' class='list-group-item' style='border-left: none;border-right: none;border-bottom: none'>" +
                                "<div class='row'>" +
                                "<div class='col-md-12' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" + recent_news_list[i].title + "&nbsp;&nbsp;<strong style='color:red;font-style:italic;'> New </strong></div>" +
                                "</div>" +
                                "</a>"
                        );
                    }

                    for (var i = 0; i < related_news_list.length; ++i) {
                        $('#news_div').append(
                                "<a href='" + related_news_list[i].url + "' target='_blank' class='list-group-item' style='border-left: none;border-right: none;border-bottom: none'>" +
                                "<div class='row'>" +
                                "<div class='col-md-12' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" + related_news_list[i].title + "</div>" +
                                "</div>" +
                                "</a>"
                        );
                    }

                }

            });


        });

        function show_frequent_label(platform_name, frequent_label) {
            var comment_chart = echarts.init(document.getElementById('comment_div'));
            var comment_option = {
                title: {
                    text: platform_name + '的用户评价',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{b} : {d}%"
                },
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: '70%',
                        center: ['50%', '60%'],
                        data: frequent_label,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            comment_chart.setOption(comment_option);
        }


    </script>


    </div>
    </div>


    <script src="{{ url_for("static",filename='js/echarts-all-2.2.7.js') }}"></script>
{% endblock %}            