{% extends "layout.html" %}

{% block title %} 全网资讯 {% endblock %}

{% block body %}

    <div class="container" style="margin-top: 60px">
        <!-- 第一行 -->
        <div class="row">
            <!-- 最近热点新闻 4条 -->

              <div class="col-md-8">
<ul class="nav nav-tabs" role="tablist">
                    <li role="presentation">
                        <a style="font-size: large"> 热点话题</a>
                    </li>

                </ul>

                <div id="carousel-example-generic" class="carousel slide" data-ride="carousel"
                 >
                    <ol class="carousel-indicators">
                        <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                        <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                        <li data-target="#carousel-example-generic" data-slide-to="2"></li>
                        <li data-target="#carousel-example-generic" data-slide-to="3"></li>
                    </ol>
                    <div class="carousel-inner" role="listbox"style="width:100%; height:340px;background-color: #1b6d85">

                        <div class="item active" style="width:100%; height:100%">
                              <img src="{{ url_for("static",filename='img/hot_topic_1.jpg') }}" style="margin: 0 auto">
                            <div class="container">
                                <div class="carousel-caption"    >
                                    <strong>
                                    <h1>e租宝涉嫌违法经营分崩离析</h1>
                                    <h4>e租宝网站以及关联公司在开展互联网金融业务中涉嫌违法经营活动，正接受有关部门调查。</h4>
                                    <p><a class="btn btn-lg btn-primary" href="/info/hot/topic/1"   target='_blank' role="button">查看专题</a></p>
                               </strong>
                                </div>
                            </div>
                        </div>

                          <div class="item" style="width:100%; height:100%">
                                <img src="{{ url_for("static",filename='img/hot_topic_2.jpg') }}" style="margin: 0 auto">

                              <div class="container">

                                <div class="carousel-caption">
                                     <strong>
                                    <h1>P2P监管办法征求意见稿发布</h1>
                                    <h4>12月28日，国务院法制办发布银监会关于《网络借贷信息中介机构业务活动管理暂行办法(征求意见稿)》。</h4>
      <p><a class="btn btn-lg btn-primary" href="/info/hot/topic/2" target='_blank' role="button">查看专题</a></p>
</strong>
                                </div>
                            </div>
                        </div>

                        <div class="item" style="width:100%; height:100%">
                               <img src="{{ url_for("static",filename='img/hot_topic_3.jpg') }}" style="margin: 0 auto">

                            <div class="container">
                                <div class="carousel-caption">
                                     <strong>
                                    <h1>宜人贷上市</h1>
                                    <h4>宜人贷纽交所挂牌成P2P网贷上市第一股</h4>
                                          <p><a class="btn btn-lg btn-primary" href="/info/hot/topic/3"  target='_blank' role="button">查看专题</a></p>
</strong>
                                </div>
                            </div>
                        </div>

                        <div class="item" style="width:100%; height:100%">
                               <img src="{{ url_for("static",filename='img/hot_topic_4.jpg') }}" style="margin: 0 auto">

                              <div class="container">
                                <div class="carousel-caption">
                                     <strong>
                                    <h1>翼龙贷3.7亿豪夺央视标王</h1>
                                    <h4>翼龙贷夺得央视《新闻联播》后黄金时段广告位,互联网金融正式迈入主流行业，进一步获得了权威媒体认可</h4>
      <p><a class="btn btn-lg btn-primary" href="/info/hot/topic/4"   target='_blank' role="button">查看专题</a></p>
</strong>
                                </div>
                            </div>
                        </div>



                        <a class="left carousel-control" href="#carousel-example-generic" role="button"
                           data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#carousel-example-generic" role="button"
                           data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
            </div>

             <div class="col-md-4">
                <ul class="nav nav-tabs " >
                    <li role="presentation">
                        <a style="font-size: large"> 热点词汇 </a>
                    </li>
                    <li id="hot_day" role="presentation" class="active"><a>今日</a></li>
                    <li id="hot_week" role="presentation"><a>本周</a></li>
                    <li id="hot_month" role="presentation"><a>本月</a></li>
                </ul>
                <div id="hot_content"
                     style="width:100%;height:350px;">
                </div>
            </div>


           <script src="{{ url_for("static",filename='js/d3.v3.min.js') }}"></script>

        <script src="{{ url_for("static",filename='js/echarts-all-2.2.7.js') }}"></script>

        <script>
            var day_hot_keywords;
            var week_hot_keywords;
            var month_hot_keywords;

            $(document).ready(function () {
                $.getJSON("/info/hot", function (data, textStatus, jqXHR) {
                    day_hot_keywords = data.day_hot_keywords;
                    week_hot_keywords = data.week_hot_keywords;
                    month_hot_keywords = data.month_hot_keywords;
                    show_hot_word(data.day_hot_keywords)
                });
            });

            // 设置点击事件
            $("#hot_day").click(function () {
                $("#hot_day").attr("class", "active");
                $("#hot_week").attr("class", "");
                $("#hot_month").attr("class", "");
                show_hot_word(day_hot_keywords);
            });

            $("#hot_week").click(function () {
                $("#hot_day").attr("class", "");
                $("#hot_week").attr("class", "active");
                $("#hot_month").attr("class", "");
                show_hot_word(week_hot_keywords);
            });

            $("#hot_month").click(function () {
                $("#hot_day").attr("class", "");
                $("#hot_week").attr("class", "");
                $("#hot_month").attr("class", "active");
                show_hot_word(month_hot_keywords);
            });

            function createRandomItemStyle() {
                var base = 225;
    return {
        normal: {
            color: 'rgb(' + [
                Math.round(Math.random() * base),
                Math.round(Math.random() * base),
                Math.round(Math.random() * base)
            ].join(',') + ')'
        }
    };
}
            // 显示热点词汇
            function show_hot_word(word_data) {

                $("#hot_content").html("");
                var color = d3.scale.category20();
                var size = 50;
                var show_data = [];
                //alert(word_data.length)
                for (var i = 0; i < word_data.length; ++i) {
                    var word = word_data[i];
                    if (size > 40)
                        size -= 4;
                    else if (size > 24)
                        size -= 2;
                    else if (size > 8)
                        size -= 1;


                    var item = {};
                    ;

                    item['name'] = word['name'];
                    item['value'] = size;
                    item['itemStyle'] = createRandomItemStyle();
                    show_data.push(item);
                    // $("#hot_content").append("<span style=font-size:" + size + "px;color:"+color(i)+" !important;>" + word + "</span>&nbsp&nbsp");
                }


                var cy_chart = echarts.init(document.getElementById('hot_content'));

                option = {

                    series: [{
                        type: 'wordCloud',
                        size: ['100%', '100%'],
                        textRotation: [0, 45, -45, 90],
                        textPadding: 1,
                        autoSize: {
                            enable: true,
                            minSize: 40
                        },
                        data: show_data
                    }]
                };

                cy_chart.setOption(option);


            }
        </script>



</div>





        <!-- 新闻部分 -->
        <div class="row"  style="margin-top: 10px;">
<div class="col-md-12">
                   </div>

            <div class="col-md-4" >


                <div id="show_xw" class="list-group" >
                      <a class="list-group-item list-group-item-heading list-group-item-danger">
                        <span class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp新闻
                    </a>
                </div>
             </div>

             <div class="col-md-4" >


                    <a class="list-group-item list-group-item-heading list-group-item-warning">
                        <span class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp政策
                    </a>
                <div id="show_zc" class="list-group" >
                </div>

  </div>


                   <div class="col-md-4" >

                         <a class="list-group-item list-group-item-heading list-group-item-success">
                        <span class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp观点
                    </a>
                <div id="show_gd" class="list-group" >
                </div>

  </div>

              <div class="col-md-12">
                   </div>

                 <div class="col-md-8" >


                <div id="show_dp" class="list-group">
                     <a class="list-group-item list-group-item-heading list-group-item-info">
                        <span class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp问答
                    </a>
                </div>

                       </div>


                 <div class="col-md-4 ">

                      <a class="list-group-item list-group-item-heading list-group-item-info">
                        <span class="glyphicon glyphicon-hand-right"></span>&nbsp&nbsp资讯来源
                    </a>

                <div id="source_summary" style="width:100%;height:400px;margin: 0 auto"></div>




                <script type="text/javascript">
                    $(document).ready(function () {
                        show_source_summary();
                    });
                    function show_source_summary() {
                        var source_summary_chart = echarts.init(document.getElementById('source_summary'));
                        source_summary_option  = {

                            tooltip: {
                                trigger: 'item',
                                formatter: "{b}:{d}%"
                            },
                            legend: {
                                left: 'left',
                                data: ["知乎", "微信","微博","融360","网贷之家", "P2P观察网", "P2P理财", "金评媒", "中申网", ]
                            },
                            series: [
                                {
                                    name: '访问来源',
                                    type: 'pie',
                                  radius: ['45%', '65%'],
                                    data: [
                                        {name: "知乎", value: 14486},
                                        {name: "微信", value: 9457},
                                        {name: "微博", value: 2313},
                                        {name: "融360", value: 1736},
                                        {name: "网贷之家", value: 266},
                                        {name: "P2P观察网", value: 222},
                                        {name: "P2P理财", value: 101},
                                        {name: "金评媒", value: 381},
                                        {name: "中申网", value: 155},

                                    ],
                                       itemStyle: {
                                        normal: {
                                            label: {
                                                show: false
                                            },
                                            labelLine: {
                                                show: false
                                            }
                                        },
                                        emphasis: {
                                            label: {
                                                show: true,
                                                position: 'center',
                                                textStyle: {
                                                    fontSize: '30',
                                                    fontWeight: 'bold'
                                                }
                                            }
                                        }
                                    }
                                }
                            ]
                        };

                        source_summary_chart.setOption(source_summary_option);
                    }
                </script>
            </div>


                <script>


                    // 根据返回信息添加元素
                    function append_info(div_id,type,color_syle) {
                        //$(div_id).html("");
                        var num = 6;
                        if (type == 'ugc') {
                            num = 10;
                         }

                        $.getJSON("/info/" + type + "/list/"+num, function (data) {
                            var items = data.type_list;
                            for (var i = 0; i < items.length; ++i) {
                                  if (type == 'ugc') {
                                    $(div_id).append(
                                        "<a href='/info/" + type + "/" + items[i]._id + "' class='list-group-item'>" +
                                        "<div class='row'>" +
                                        "<div class='col-md-12'   style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color: #2b669a'>" +
                                             "<strong>Q: </strong>&nbsp&nbsp" + items[i].title + "</div>" +
                                        "</div>" +
                                        "<div class='row' style='margin-top:5px'>" +
                                        "<div class='col-md-9' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>" +
                                            "<strong>A: </strong>&nbsp&nbsp" + items[i].content + "</div>" +
                                        "<div class='col-md-3'  style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>"  + items[i].author+"&nbsp;&nbsp; "+ items[i].item_pub_time +"</div>" +
                                        "</div>" +
                                        "</a>"
                                    );
                                }else{
                                 var title= items[i].title;
                                      if(title.length==0) {
                                     var content = items[i].content
                                   //  content = content.replace(new RegExp("#n#", "gm"), "")
                                    // content = content.replace(new RegExp("#r#", "gm"), "")
                                     //content = content.replace(new RegExp(" ", "gm"), "")
                                          title = content;
                                 }


                                      var head_str= '&nbsp;<span class="label label-default">';

                                       if (type == 'news') {
                                            head_str= '&nbsp;<span class="label label-danger">';
                                        }else if(type=='policy'){
                                           head_str= '&nbsp;<span class="label label-warning">';
                                       }else if(type=='opinion'){
                                             head_str= '&nbsp;<span class="label label-success">';
                                      }

                                      var tags_str = "";
                                      var tags = items[i].tags;
                                      if(tags.length >0 ){
                                          var tags_list = tags.split(',');
                                          for(var j =0;j<tags_list.length;++j){
                                              tag = tags_list[j]
                                            tags_str += head_str+ tag+'</span>';
                                          }

                                    }


                                    $(div_id).append(
                                        "<a href='/info/" + type + "/" + items[i]._id + "' class='list-group-item '>" +
                                        "<div class='row'>" +
                                        "<div class='col-md-12'>"
                                        +"<div style='font-size: large;width:95%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>"+ title + "</div>"
                                       +"<div style='margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>"+items[i].item_pub_time+"&nbsp;&nbsp;&nbsp;&nbsp;" +items[i].author+tags_str+"</div>"+

                                        "</div>" +
                                        "</div>" +
                                        "</a>"
                                    );
                                      }
                            }
                                 $(div_id).append(
                                        "<a href='/info/" + type +  "' class='list-group-item' style='text-align:center;'>点击查看更多</a>"

                                 );
                        });
                    }

                    // 加载数据
                    $(document).ready(function () {
                       append_info("#show_xw","news","danger");
                        append_info("#show_zc","policy","danger");
       append_info("#show_gd","opinion","danger");
                   append_info("#show_dp","ugc","danger");

                    });


                </script>

        </div>

        <!-- 连接
        <div class="well">
            <strong>友情链接</strong><br/><br/>
            <ul class="list-inline">
                <li><a title="融360" href="http://www.rong360.com" target="_blank">融360</a></li>
                <li><a title="理财" href="http://www.rong360.com/licai/" target="_blank">理财</a></li>
                <li><a title="贷款" href="http://www.rong360.com/daikuan/" target="_blank">贷款</a></li>
                <li><a title="信用卡" href="http://www.rong360.com/credit/" target="_blank">信用卡</a></li>
                <li><a title="攻略" href="http://www.rong360.com/gl/" target="_blank">攻略</a></li>
                <li><a title="问答" href="http://www.rong360.com/ask/" target="_blank">问答</a></li>
                <li><a title="旅游社区" href="http://bbs.yilvcheng.com" target="_blank">旅游社区</a></li>
                <li><a title="建材家居" href="http://news.17house.com" target="_blank">建材家居</a></li>
                <li><a title="掌柜吧" href="http://bbs.tzg.cn/" target="_blank">掌柜吧</a></li>
                <li><a title="问答平台" href="http://www.wenda114.com/" target="_blank">问答平台</a></li>
                <li><a title="列表问答" href="http://www.liebiao.com/wenda/" target="_blank">列表问答</a></li>
                <li><a title="网贷问答" href="http://www.p2peye.com/ask/" target="_blank">网贷问答</a></li>
                <li><a title="信用卡论坛" href="http://www.9icard.com/" target="_blank">信用卡论坛</a></li>
                <li><a title="理财平台" href="http://www.qianyilc.com/" target="_blank">理财平台</a></li>
                <li><a title="证券" href="http://www.zhonghuacaifu.cn/" target="_blank">证券</a></li>
                <li><a title="广州装修论坛" href="http://homebbs.gz.fang.com/board/gzzxlt/" target="_blank">广州装修论坛</a>
                </li>
                <li><a title="深圳二手房" href="http://sz.esf.loupan.com/" target="_blank">深圳二手房</a></li>
                <li><a title="网贷论坛" href="http://www.wangdaiwanjia.com/" target="_blank">网贷论坛</a></li>
                <li><a title="白银论坛" href="http://bbs.huangjinzhijia.com/" target="_blank">白银论坛</a></li>
                <li><a title="原油现货投资" href="http://www.oil988.com/" target="_blank">原油现货投资</a></li>
                <li><a title="专利查询" href="http://patent.1633.com/" target="_blank">专利查询</a></li>
                <li><a title="外汇开户" href="http://www.niumoney.com/" target="_blank">外汇开户</a></li>
                <li><a title="伦敦金开户" href="http://www.gold2u.com/" target="_blank">伦敦金开户</a></li>
                <li><a title="抵押贷款" href="http://ww.bjsudai.com " target="_blank">抵押贷款</a></li>
                <li><a title="原油交易" href="http://www.in001.com/" target="_blank">原油交易</a></li>
                <li><a title="P2P理财" href="http://www.newunion.cn/" target="_blank">P2P理财</a></li>
                <li><a title="南京贷款" href="http://nanjing.rongzi.com/" target="_blank">南京贷款</a></li>
                <li><a title="p2p网贷" href="http://www.baidaiw.com/" target="_blank">p2p网贷</a></li>
                <li><a title="沪商财富" href="http://www.hushangcaifu.com" target="_blank">沪商财富</a></li>
                <li><a title="金银猫" href="http://www.jinyinmao.com.cn/" target="_blank">金银猫</a></li>
                <li><a title="投资策略" href="http://www.cjyjy.cn/" target="_blank">投资策略</a></li>
                <li><a title="全讯网" href="http://www.45n.cc/" target="_blank">全讯网</a></li>
                <li><a title="信用卡大全" href="http://card.dn1234.com/" target="_blank">信用卡大全</a></li>
                <li><a title="P2P理财论坛" href="http://bbs.xueshandai.com" target="_blank">P2P理财论坛</a></li>
                <li><a title="网贷东方" href="http://bbs.wangdaidongfang.com/" target="_blank">网贷东方</a></li>
                <li><a title="汇通评论" href="http://pinglun.fx678.com/" target="_blank">汇通评论</a></li>
                <li><a title="大学生贷款" href="http://www.xiaoshushidai.com/" target="_blank">大学生贷款</a></li>
                <li><a title="人人贷" href="http://bbs.we.com/" target="_blank">人人贷</a></li>
                <li><a title="芒果金融" href="https://www.hnmgjr.com/" target="_blank">芒果金融</a></li>
            </ul>
        </div>
-->
    </div>
{% endblock %}