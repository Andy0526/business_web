{% extends "detail_info.html" %}

{% block body %}

    <div class="container" style="margin-top: 70px;">

        <div class="row">
            <div class="col-md-12" >

                <p><strong>共<span id="platform_num">0</span>条记录</strong></p>
                <table class="table table-hover">
                    <thead>
                    <tr></tr>
                    <tr class="info">
                        <th>编号</th>
                        <th>平台</th>

                        <th>
                                人气指数

                            <!--div class="dropdown" >
                                人气指数
                           <span  class="dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                <span class="caret"></span>
                            </span>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" >
                                    <li onclick="platform_sort('人气指数','1')"><a>递增排序</a></li>
                                    <li onclick="platform_sort('人气指数','-1')"><a>递减排序</a></li>
                                </ul>
                            </div-->
                        </th>

                        <th>
                              评级
                            <!--div class="dropdown" >
                                评级
                           <span  class="dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                <span class="caret"></span>
                            </span>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" >
                                    <li onclick="platform_sort('评级','1')"><a>递增排序</a></li>
                                    <li onclick="platform_sort('评级','-1')"><a>递减排序</a></li>
                                </ul>
                            </div-->
                        </th>


                        <th>
                            平均收益
                            <!--div class="dropdown" >
                                平均收益
                           <span  class="dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                <span class="caret"></span>
                            </span>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" >
                                    <li onclick="platform_sort('平均收益','1')"><a>递增排序</a></li>
                                    <li onclick="platform_sort('平均收益','-1')"><a>递减排序</a></li>
                                </ul>
                            </div-->
                        </th>
                        <th>平台背景</th>
                        <th>上线时间</th>

                        <th>平均利率</th>
                        <th>成交量</th>
                        <th>平均借款期限</th>
                        <th>累计待还金额</th>

                    </tr>
                    </thead>

                    <tbody>
                    </tbody>
                </table>

                <script>

                    // 数据缓存
                    var data_info;

                    $(document).ready(function(){
                        $.getJSON("/detail/platforms", function(data, textStatus, jqXHR){
                            data_info = data.platforms;
                            $("#platform_num").text(data_info.length);
                            platform_sort('人气指数','-1');
                            //show_data(data_info);
                        });
                    });

                    function show_data(data_info) {
                        $("tbody").html(""); // 清空
                        for (var i = 0; i < data_info.length; ++i) { // 逐个渲染
                            var info = data_info[i];
                            $("tbody").append("<tr>" +
                                    "<td>" + (i + 1) + "</td>" +
                                    "<td> <a href= '/detail/platform/" + info.platform_name + "'>" + info.platform_name + "</a></td>" +
                                    "<td>" + info.platform_index + "</td>" +
                                    "<td>" + info.platform_rank + "</td>" +
                                    "<td>" + info.platform_earn + "</td>" +
                                    "<td>" + info.platform_background + "</td>" +
                                    "<td>" + info.platform_time + "</td>" +
                                    "<td>" + info.platform_rate + "</td>" +
                                    "<td>" + info.platform_volume + "</td>" +
                                    "<td>" + info.platform_borrowing_period + "</td>" +
                                    "<td>" + info.platform_need_return + "</td>"+
                                    "</tr>"
                            );
                        }
                    }

                    function platform_sort(tag,updown){
                        if(tag=='评级'){
                            data_info.sort(
                                    function(d1,d2) {
                                        return d1.platform_rank.localeCompare(d2.platform_rank)*updown;
                                    }
                            );
                            show_data(data_info);
                            return;
                        }

                        if(tag=='人气指数'){
                            data_info.sort(
                                    function(d1,d2) {
                                        return (d1.platform_index-d2.platform_index)*updown;
                                    }
                            );
                            show_data(data_info);
                            return;
                        }

                        if(tag=='平均收益'){
                            data_info.sort(
                                    function(d1,d2) {
                                        var r1 =  d1.platform_earn.substr(0, d1.platform_earn.length-1); // 获取子字符串
                                        var r2 =  d2.platform_earn.substr(0, d2.platform_earn.length-1); // 获取子字符串
                                        return (parseFloat(r1) - parseFloat(r2))*updown;
                                    }
                            );
                            show_data(data_info);
                            return;
                        }
                    }
                </script>

            </div>

        </div>

    </div>

{% endblock %}